<div class="container mt-4">
  <div class="row">
    <div class="col-lg-8">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h2 class="mb-0">Order #<%= @order.id %></h2>
              <small>Placed on <%= @order.order_date.strftime("%B %d, %Y at %I:%M %p") %></small>
            </div>
            <div>
              <% status_class = case @order.status
                               when 'pending' then 'warning'
                               when 'completed' then 'success'
                               when 'shipped' then 'info'
                               when 'cancelled' then 'danger'
                               else 'secondary'
                               end %>
              <span class="badge badge-<%= status_class %> px-3 py-2" style="font-size: 0.9rem;">
                <%= @order.status.titleize %>
              </span>
            </div>
          </div>
        </div>
        <div class="card-body">
          <!-- Order Items -->
          <h5 class="text-primary mb-3">Order Items</h5>
          <% @order.order_items.each do |item| %>
            <div class="row align-items-center border-bottom py-3">
              <div class="col-md-2">
                <% if item.product.image.attached? %>
                  <%= image_tag item.product.image.variant(resize_to_limit: [80, 80]), 
                      class: "img-fluid rounded" %>
                <% else %>
                  <div class="bg-light rounded d-flex align-items-center justify-content-center" 
                       style="height: 80px; width: 80px;">
                    <i class="fas fa-image text-muted"></i>
                  </div>
                <% end %>
              </div>
              <div class="col-md-5">
                <h6 class="mb-1">
                  <%= link_to item.product.title, product_path(item.product), 
                      class: "text-decoration-none" %>
                </h6>
                <small class="text-muted">
                  Category: <%= item.product.category.name %>
                </small>
              </div>
              <div class="col-md-2 text-center">
                <span class="badge badge-light">Qty: <%= item.quantity %></span>
              </div>
              <div class="col-md-1 text-right">
                <strong>$<%= '%.2f' % item.unit_price %></strong>
              </div>
              <div class="col-md-2 text-right">
                <strong>$<%= '%.2f' % (item.unit_price * item.quantity) %></strong>
              </div>
            </div>
          <% end %>

          <!-- Tax Breakdown -->
          <div class="mt-4">
            <h6 class="text-primary">Tax Breakdown</h6>
            <div class="row">
              <div class="col-md-6">
                <% total_gst = @order.order_items.sum(:applied_gst) %>
                <% total_pst = @order.order_items.sum(:applied_pst) %>
                <% total_hst = @order.order_items.sum(:applied_hst) %>
                
                <% if total_gst > 0 %>
                  <div class="d-flex justify-content-between">
                    <span>GST (<%= '%.1f' % (@order.province.gst * 100) %>%):</span>
                    <span>$<%= '%.2f' % total_gst %></span>
                  </div>
                <% end %>
                <% if total_pst > 0 %>
                  <div class="d-flex justify-content-between">
                    <span>PST (<%= '%.1f' % (@order.province.pst * 100) %>%):</span>
                    <span>$<%= '%.2f' % total_pst %></span>
                  </div>
                <% end %>
                <% if total_hst > 0 %>
                  <div class="d-flex justify-content-between">
                    <span>HST (<%= '%.1f' % (@order.province.hst * 100) %>%):</span>
                    <span>$<%= '%.2f' % total_hst %></span>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Summary & Details -->
    <div class="col-lg-4">
      <!-- Order Summary -->
      <div class="card mb-4">
        <div class="card-header bg-light">
          <h5 class="mb-0">Order Summary</h5>
        </div>
        <div class="card-body">
          <div class="d-flex justify-content-between mb-2">
            <span>Subtotal:</span>
            <span>$<%= '%.2f' % @order.subtotal %></span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Total Tax:</span>
            <span>$<%= '%.2f' % @order.total_tax %></span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Shipping:</span>
            <span>$0.00</span>
          </div>
          <hr>
          <div class="d-flex justify-content-between mb-3">
            <strong>Grand Total:</strong>
            <strong class="text-success">$<%= '%.2f' % @order.grand_total %></strong>
          </div>
        </div>
      </div>

      <!-- Customer Information -->
      <div class="card mb-4">
        <div class="card-header bg-light">
          <h5 class="mb-0">Customer Information</h5>
        </div>
        <div class="card-body">
          <div class="d-flex align-items-center mb-3">
            <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center mr-3" 
                 style="width: 40px; height: 40px;">
              <i class="fas fa-user text-white"></i>
            </div>
            <div>
              <strong><%= @order.user.name %></strong><br>
              <small class="text-muted"><%= @order.user.email %></small>
            </div>
          </div>
        </div>
      </div>

      <!-- Shipping Address -->
      <div class="card mb-4">
        <div class="card-header bg-light">
          <h5 class="mb-0">
            <i class="fas fa-shipping-fast mr-2"></i>Shipping Address
          </h5>
        </div>
        <div class="card-body">
          <address class="mb-0">
            <strong><%= @order.user.name %></strong><br>
            <%= @order.address.street %><br>
            <%= @order.address.city %>, <%= @order.province.code %> <%= @order.address.postal_code %><br>
            <strong>Province:</strong> <%= @order.province.name %>
          </address>
        </div>
      </div>

      <!-- Order Details -->
      <div class="card mb-4">
        <div class="card-header bg-light">
          <h5 class="mb-0">
            <i class="fas fa-info-circle mr-2"></i>Order Details
          </h5>
        </div>
        <div class="card-body">
          <div class="row mb-2">
            <div class="col-6"><strong>Order ID:</strong></div>
            <div class="col-6">#<%= @order.id %></div>
          </div>
          <div class="row mb-2">
            <div class="col-6"><strong>Order Date:</strong></div>
            <div class="col-6"><%= @order.order_date.strftime("%m/%d/%Y") %></div>
          </div>
          <div class="row mb-2">
            <div class="col-6"><strong>Order Time:</strong></div>
            <div class="col-6"><%= @order.order_date.strftime("%I:%M %p") %></div>
          </div>
          <div class="row mb-2">
            <div class="col-6"><strong>Status:</strong></div>
            <div class="col-6">
              <span class="badge badge-<%= status_class %>">
                <%= @order.status.titleize %>
              </span>
            </div>
          </div>
          <div class="row mb-2">
            <div class="col-6"><strong>Items Count:</strong></div>
            <div class="col-6"><%= @order.order_items.sum(:quantity) %> items</div>
          </div>
          <div class="row mb-2">
            <div class="col-6"><strong>Tax Region:</strong></div>
            <div class="col-6"><%= @order.province.name %> (<%= @order.province.code %>)</div>
          </div>
          <div class="row">
            <div class="col-6"><strong>Payment Method:</strong></div>
            <div class="col-6">Cash on Delivery</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-12">
      <%= link_to "← Back to Orders", orders_path, class: "btn btn-outline-primary" %>
      <%= link_to "Continue Shopping", products_path, class: "btn btn-primary ml-2" %>
      <button class="btn btn-outline-secondary ml-2" onclick="window.print()">
        <i class="fas fa-print mr-1"></i>Print Order
      </button>
    </div>
  </div>
</div>

<!-- Print Styles -->
<style media="print">
  .btn, .navbar, .breadcrumb {
    display: none !important;
  }
  
  .container {
    max-width: 100% !important;
  }
  
  .card {
    border: 1px solid #ddd !important;
    box-shadow: none !important;
  }
  
  .card-header {
    background-color: #f8f9fa !important;
    color: #333 !important;
  }
</style>